<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | DreamyBeautyHub</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Quill Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --rose: #E8A0BF;
            --rose-dark: #D488A3;
            --rose-light: #F3D1DC;
            --cream: #FFF8F3;
            --white: #FFFFFF;
            --charcoal: #2D2D2D;
            --gray: #6B6B6B;
            --light-gray: #F5F5F5;
            --border: #E5E5E5;
            --danger: #EF4444;
            --success: #10B981;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--light-gray);
            color: var(--charcoal);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Login */
        .login-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--cream) 0%, var(--white) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .login-card {
            background: var(--white);
            padding: 60px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 450px;
            width: 90%;
        }

        .login-card h2 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--charcoal);
        }

        .login-card p {
            color: var(--gray);
            margin-bottom: 35px;
            font-size: 1.05rem;
        }

        .login-card input {
            width: 100%;
            padding: 18px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 25px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .login-card input:focus {
            outline: none;
            border-color: var(--rose);
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: var(--white);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 35px 25px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 60px;
        }

        .brand img {
            height: 55px;
        }

        .brand-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--charcoal);
        }

        .nav-item {
            padding: 18px 22px;
            margin-bottom: 10px;
            border-radius: 12px;
            cursor: pointer;
            color: var(--charcoal);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 18px;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .nav-item i {
            width: 22px;
            text-align: center;
            font-size: 1.1rem;
        }

        .nav-item:hover {
            background: var(--cream);
            color: var(--rose-dark);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--rose) 0%, var(--rose-dark) 100%);
            color: var(--white);
        }

        /* Main */
        .main {
            flex: 1;
            padding: 45px;
            overflow-y: auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 45px;
        }

        .page-title {
            font-size: 2.5rem;
            color: var(--charcoal);
        }

        .btn {
            padding: 14px 32px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--rose) 0%, var(--rose-dark) 100%);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(232, 160, 191, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(232, 160, 191, 0.4);
        }

        .btn-secondary {
            background: var(--light-gray);
            color: var(--charcoal);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #DC2626;
        }

        .btn-sm {
            padding: 10px 20px;
            font-size: 0.85rem;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: var(--white);
            padding: 35px;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--rose-dark);
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 1rem;
        }

        /* Card */
        .card {
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        /* Table */
        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 18px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--light-gray);
            font-weight: 600;
            color: var(--charcoal);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        tbody tr {
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: var(--cream);
        }

        .table-img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 10px;
        }

        /* Form */
        .form-card {
            background: var(--white);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 35px;
        }

        .form-group {
            margin-bottom: 28px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--charcoal);
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--rose);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
        }

        /* Editor */
        #editor {
            height: 450px;
        }

        .ql-toolbar {
            border-radius: 12px 12px 0 0 !important;
            border: 2px solid var(--border) !important;
            border-bottom: none !important;
        }

        .ql-container {
            border: 2px solid var(--border) !important;
            border-radius: 0 0 12px 12px !important;
        }

        /* Views */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Category List */
        .category-list {
            list-style: none;
        }

        .category-item {
            background: var(--white);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }

        .category-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .category-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .category-img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 10px;
        }

        .category-name {
            font-weight: 600;
            font-size: 1.15rem;
            color: var(--charcoal);
        }

        .category-actions {
            display: flex;
            gap: 10px;
        }

        /* Upload Progress */
        .upload-progress {
            display: none;
            color: var(--rose);
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background: #D1FAE5;
            color: #065F46;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border);
            }

            .main {
                padding: 25px;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
        }
    </style>
</head>

<body>
    <!-- Login -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-card">
            <h2>üîê Admin Access</h2>
            <p>Enter your PIN to continue</p>
            <input type="password" id="pinInput" placeholder="Enter PIN" maxlength="6">
            <button class="btn btn-primary" onclick="admin.login()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
            <div class="nav-item" onclick="admin.navigate('posts')">
                <i class="fas fa-images"></i> Posts
            </div>
            <div class="nav-item" onclick="admin.navigate('categories')">
                <i class="fas fa-tags"></i> Categories
            </div>
            <div class="nav-item" onclick="window.open('user.html', '_blank')">
                <i class="fas fa-external-link-alt"></i> View Site
            </div>
            </aside>

            <!-- Main -->
            <main class="main">
                <!-- Dashboard -->
                <div id="dashboard" class="view active">
                    <div class="page-header">
                        <h1 class="page-title">Dashboard</h1>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalPosts">0</div>
                            <div class="stat-label">Total Posts</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalCategories">0</div>
                            <div class="stat-label">Categories</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="featuredPosts">0</div>
                            <div class="stat-label">Featured Posts</div>
                        </div>
                    </div>
                </div>

                <!-- Posts -->
                <div id="posts" class="view">
                    <div class="page-header">
                        <h1 class="page-title">Posts</h1>
                        <button class="btn btn-primary" onclick="admin.showPostEditor()">
                            <i class="fas fa-plus"></i> New Post
                        </button>
                    </div>
                    <div class="card">
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Title</th>
                                        <th>Category</th>
                                        <th>Date</th>
                                        <th>Featured</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="postsTable">
                                    <!-- Posts loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Post Editor -->
                <div id="postEditor" class="view">
                    <div class="page-header">
                        <h1 class="page-title" id="editorTitle">Create Post</h1>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-secondary" onclick="admin.navigate('posts')">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                            <button class="btn btn-primary" onclick="admin.savePost()">
                                <i class="fas fa-save"></i> Save Post
                            </button>
                        </div>
                    </div>

                    <div class="form-card">
                        <div class="form-group">
                            <label class="form-label">Post Title</label>
                            <input type="text" id="postTitle" class="form-control"
                                placeholder="Enter a captivating title...">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Featured Image</label>
                            <div style="display: flex; gap: 12px;">
                                <input type="text" id="postImage" class="form-control"
                                    placeholder="Image URL will appear here..." readonly style="flex: 1;">
                                <input type="file" id="postImageFile" accept="image/*" style="display: none;"
                                    onchange="admin.uploadImage(this)">
                                <button class="btn btn-primary"
                                    onclick="document.getElementById('postImageFile').click()">
                                    <i class="fas fa-upload"></i> Upload
                                </button>
                            </div>
                            <div class="upload-progress" id="uploadProgress">Uploading...</div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select id="postCategory" class="form-control">
                                    <option value="">Select Category</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Featured Post</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="postFeatured">
                                    <label for="postFeatured" style="margin: 0;">Mark as featured</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Content</label>
                            <div id="editor"></div>
                        </div>
                    </div>
                </div>

                <!-- Categories -->
                <div id="categories" class="view">
                    <div class="page-header">
                        <h1 class="page-title">Categories</h1>
                    </div>

                    <div class="form-card">
                        <h3 style="margin-bottom: 25px; font-size: 1.3rem;" id="categoryFormTitle">Add New Category</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Category Name</label>
                                <input type="text" id="categoryName" class="form-control"
                                    placeholder="e.g., Fall Nails, Winter Nails">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Image URL</label>
                                <input type="text" id="categoryImage" class="form-control"
                                    placeholder="https://example.com/image.jpg">
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-primary" id="categoryActionBtn" onclick="admin.handleCategory()">
                                <i class="fas fa-plus"></i> Add Category
                            </button>
                            <button class="btn btn-secondary" id="cancelCategoryBtn" style="display: none;"
                                onclick="admin.resetCategoryForm()">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>

                    <ul class="category-list" id="categoryList">
                        <!-- Categories loaded here -->
                    </ul>
                </div>
            </main>

            <!-- Quill -->
            <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

            <!-- Firebase -->
            <script type="module">
                import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
                import { getFirestore, collection, getDocs, addDoc, doc, deleteDoc, updateDoc, getDoc, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
                import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

                const firebaseConfig = {
                    apiKey: "AIzaSyApYYIEiyvpNGO9m1g7JBA3e4Q6x1CSrMM",
                    authDomain: "dreamybeautyhub-b0500.firebaseapp.com",
                    databaseURL: "https://dreamybeautyhub-b0500-default-rtdb.firebaseio.com",
                    projectId: "dreamybeautyhub-b0500",
                    storageBucket: "dreamybeautyhub-b0500.firebasestorage.app",
                    messagingSenderId: "465258211378",
                    appId: "1:465258211378:web:2635d10695b0a39970742b",
                    measurementId: "G-CLQSNKV9GE"
                };

                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                const storage = getStorage(app);

                // Quill Editor
                const quill = new Quill('#editor', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline', 'strike'],
                            ['blockquote', 'code-block'],
                            [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                            [{ 'color': [] }, { 'background': [] }],
                            ['link', 'image'],
                            ['clean']
                        ]
                    }
                });

                class AdminApp {
                    constructor() {
                        this.currentPostId = null;
                        this.currentCategoryId = null;
                        this.init();
                    }

                    init() {
                        if (sessionStorage.getItem('admin_auth') === 'true') {
                            document.getElementById('loginOverlay').style.display = 'none';
                            this.loadDashboard();
                        }

                        document.getElementById('pinInput').addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') this.login();
                        });

                        document.getElementById('categoryName').addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') this.handleCategory();
                        });
                    }

                    login() {
                        const pin = document.getElementById('pinInput').value;
                        if (pin === '798582') {
                            sessionStorage.setItem('admin_auth', 'true');
                            document.getElementById('loginOverlay').style.display = 'none';
                            this.loadDashboard();
                        } else {
                            alert('‚ùå Invalid PIN');
                        }
                    }

                    navigate(viewId) {
                        document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
                        document.getElementById(viewId).classList.add('active');

                        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                        event.currentTarget.classList.add('active');

                        if (viewId === 'posts') this.loadPosts();
                        if (viewId === 'categories') this.loadCategories();
                        if (viewId === 'dashboard') this.loadDashboard();
                    }

                    async loadDashboard() {
                        try {
                            const postsSnap = await getDocs(collection(db, "posts"));
                            const catsSnap = await getDocs(collection(db, "categories"));

                            let featured = 0;
                            postsSnap.forEach(doc => {
                                if (doc.data().featured) featured++;
                            });

                            document.getElementById('totalPosts').innerText = postsSnap.size;
                            document.getElementById('totalCategories').innerText = catsSnap.size;
                            document.getElementById('featuredPosts').innerText = featured;
                        } catch (e) {
                            console.error("Error loading dashboard:", e);
                        }
                    }

                    async loadPosts() {
                        try {
                            const snapshot = await getDocs(collection(db, "posts"));
                            const tbody = document.getElementById('postsTable');
                            tbody.innerHTML = '';

                            if (snapshot.empty) {
                                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 50px; color: var(--gray);">No posts yet. Create your first post!</td></tr>';
                                return;
                            }

                            snapshot.forEach(docSnap => {
                                const post = docSnap.data();
                                const tr = document.createElement('tr');

                                const date = new Date(post.date).toLocaleDateString();
                                const featured = post.featured ? '<span class="badge badge-success">Featured</span>' : '';

                                tr.innerHTML = `
                            <td>
                                ${post.image ?
                                        `<img src="${post.image}" class="table-img" alt="${post.title}">` :
                                        '<div style="width: 70px; height: 70px; background: var(--border); border-radius: 10px;"></div>'
                                    }
                            </td>
                            <td style="font-weight: 500;">${post.title}</td>
                            <td>${post.category || 'Uncategorized'}</td>
                            <td>${date}</td>
                            <td>${featured}</td>
                            <td>
                                <div style="display: flex; gap: 8px;">
                                    <button class="btn btn-primary btn-sm" onclick="admin.editPost('${docSnap.id}')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="admin.deletePost('${docSnap.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                                tbody.appendChild(tr);
                            });
                        } catch (e) {
                            console.error("Error loading posts:", e);
                        }
                    }

                    showPostEditor(id = null) {
                        this.currentPostId = id;
                        this.navigate('postEditor');
                        this.loadCategoriesSelect();

                        if (id) {
                            document.getElementById('editorTitle').innerText = 'Edit Post';
                        } else {
                            document.getElementById('postTitle').value = '';
                            document.getElementById('postImage').value = '';
                            document.getElementById('postImageFile').value = '';
                            document.getElementById('postFeatured').checked = false;
                            quill.root.innerHTML = '';
                            document.getElementById('editorTitle').innerText = 'Create Post';
                        }
                    }

                    async uploadImage(input) {
                        const file = input.files[0];
                        if (!file) return;

                        const progress = document.getElementById('uploadProgress');
                        progress.style.display = 'block';
                        progress.innerText = `Uploading ${file.name}...`;

                        try {
                            const storageRef = ref(storage, 'posts/' + Date.now() + '_' + file.name);
                            await uploadBytes(storageRef, file);
                            const url = await getDownloadURL(storageRef);

                            document.getElementById('postImage').value = url;
                            progress.innerText = '‚úÖ Upload complete!';
                            progress.style.color = 'var(--success)';

                            setTimeout(() => {
                                progress.style.display = 'none';
                                progress.style.color = 'var(--rose)';
                            }, 2000);
                        } catch (e) {
                            console.error("Error uploading:", e);
                            progress.innerText = '‚ùå Error: ' + e.message;
                            progress.style.color = 'var(--danger)';
                        }
                    }

                    async editPost(id) {
                        this.currentPostId = id;
                        this.navigate('postEditor');
                        this.loadCategoriesSelect();
                        document.getElementById('editorTitle').innerText = 'Edit Post';

                        try {
                            const docRef = doc(db, "posts", id);
                            const docSnap = await getDoc(docRef);

                            if (docSnap.exists()) {
                                const data = docSnap.data();
                                document.getElementById('postTitle').value = data.title;
                                document.getElementById('postImage').value = data.image || '';
                                document.getElementById('postCategory').value = data.category || '';
                                document.getElementById('postFeatured').checked = data.featured || false;
                                quill.root.innerHTML = data.content;
                            }
                        } catch (e) {
                            console.error("Error editing post:", e);
                            alert('‚ùå Error loading post');
                        }
                    }

                    async savePost() {
                        const title = document.getElementById('postTitle').value.trim();
                        const image = document.getElementById('postImage').value.trim();
                        const category = document.getElementById('postCategory').value;
                        const content = quill.root.innerHTML;
                        const featured = document.getElementById('postFeatured').checked;

                        if (!title) {
                            alert('‚ùå Please enter a title');
                            return;
                        }

                        if (!category) {
                            alert('‚ùå Please select a category');
                            return;
                        }

                        const postData = {
                            title,
                            image,
                            category,
                            content,
                            featured,
                            date: new Date().toISOString()
                        };

                        try {
                            if (this.currentPostId) {
                                await updateDoc(doc(db, "posts", this.currentPostId), postData);
                                alert('‚úÖ Post updated!');
                            } else {
                                await addDoc(collection(db, "posts"), postData);
                                alert('‚úÖ Post created!');
                            }
                            this.navigate('posts');
                        } catch (e) {
                            console.error("Error saving post:", e);
                            alert('‚ùå Error saving post');
                        }
                    }

                    async deletePost(id) {
                        if (confirm('‚ö†Ô∏è Delete this post?')) {
                            try {
                                await deleteDoc(doc(db, "posts", id));
                                alert('‚úÖ Post deleted!');
                                this.loadPosts();
                            } catch (e) {
                                console.error("Error deleting post:", e);
                                alert('‚ùå Error deleting post');
                            }
                        }
                    }

                    async loadCategories() {
                        try {
                            const snapshot = await getDocs(collection(db, "categories"));
                            const list = document.getElementById('categoryList');
                            list.innerHTML = '';

                            if (snapshot.empty) {
                                list.innerHTML = '<p style="text-align: center; padding: 50px; color: var(--gray);">No categories yet. Add your first category!</p>';
                                return;
                            }

                            snapshot.forEach(docSnap => {
                                const data = docSnap.data();
                                const li = document.createElement('li');
                                li.className = 'category-item';

                                const safeName = data.name.replace(/'/g, "\\'");
                                const safeImage = (data.image || '').replace(/'/g, "\\'");

                                li.innerHTML = `
                            <div class="category-info">
                                ${data.image ?
                                        `<img src="${data.image}" alt="${data.name}" class="category-img">` :
                                        '<div style="width: 70px; height: 70px; background: var(--border); border-radius: 10px;"></div>'
                                    }
                                <span class="category-name">${data.name}</span>
                            </div>
                            <div class="category-actions">
                                <button class="btn btn-primary btn-sm" onclick="admin.editCategory('${docSnap.id}', '${safeName}', '${safeImage}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="admin.deleteCategory('${docSnap.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                                list.appendChild(li);
                            });
                        } catch (e) {
                            console.error("Error loading categories:", e);
                        }
                    }

                    async loadCategoriesSelect() {
                        try {
                            const snapshot = await getDocs(collection(db, "categories"));
                            const select = document.getElementById('postCategory');
                            select.innerHTML = '<option value="">Select Category</option>';

                            snapshot.forEach(docSnap => {
                                const opt = document.createElement('option');
                                opt.value = docSnap.data().name;
                                opt.innerText = docSnap.data().name;
                                select.appendChild(opt);
                            });
                        } catch (e) {
                            console.error("Error loading categories:", e);
                        }
                    }

                    async handleCategory() {
                        if (this.currentCategoryId) {
                            await this.updateCategory();
                        } else {
                            await this.addCategory();
                        }
                    }

                    async addCategory() {
                        const name = document.getElementById('categoryName').value.trim();
                        const image = document.getElementById('categoryImage').value.trim();

                        if (!name) {
                            alert('‚ùå Please enter a category name');
                            return;
                        }

                        try {
                            await addDoc(collection(db, "categories"), { name, image });
                            alert('‚úÖ Category added!');
                            this.resetCategoryForm();
                            this.loadCategories();
                        } catch (e) {
                            console.error("Error adding category:", e);
                            alert('‚ùå Error adding category');
                        }
                    }

                    editCategory(id, name, image) {
                        this.currentCategoryId = id;
                        document.getElementById('categoryName').value = name;
                        document.getElementById('categoryImage').value = image || '';
                        document.getElementById('categoryFormTitle').innerText = 'Edit Category';
                        document.getElementById('categoryActionBtn').innerHTML = '<i class="fas fa-save"></i> Update Category';
                        document.getElementById('cancelCategoryBtn').style.display = 'inline-flex';
                    }

                    async updateCategory() {
                        const name = document.getElementById('categoryName').value.trim();
                        const image = document.getElementById('categoryImage').value.trim();

                        if (!name) {
                            alert('‚ùå Please enter a category name');
                            return;
                        }

                        try {
                            await updateDoc(doc(db, "categories", this.currentCategoryId), { name, image });
                            alert('‚úÖ Category updated!');
                            this.resetCategoryForm();
                            this.loadCategories();
                        } catch (e) {
                            console.error("Error updating category:", e);
                            alert('‚ùå Error updating category');
                        }
                    }

                    async deleteCategory(id) {
                        if (confirm('‚ö†Ô∏è Delete this category?')) {
                            try {
                                await deleteDoc(doc(db, "categories", id));
                                alert('‚úÖ Category deleted!');
                                this.loadCategories();
                            } catch (e) {
                                console.error("Error deleting category:", e);
                                alert('‚ùå Error deleting category');
                            }
                        }
                    }

                    resetCategoryForm() {
                        this.currentCategoryId = null;
                        document.getElementById('categoryName').value = '';
                        document.getElementById('categoryImage').value = '';
                        document.getElementById('categoryFormTitle').innerText = 'Add New Category';
                        document.getElementById('categoryActionBtn').innerHTML = '<i class="fas fa-plus"></i> Add Category';
                        document.getElementById('cancelCategoryBtn').style.display = 'none';
                    }
                }

                window.admin = new AdminApp();
            </script>
</body>

</html>
